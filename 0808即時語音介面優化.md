# 即時語音互動介面技術選型建議（React / Next.js / 其他）

## 引言

你要做的是 **LIFF 手機網頁上的即時語音互動**：按住錄音 → 傳送 → AI 即時回覆（TTS）並驅動中間圓圈的 radiowave 動畫。這類應用的**關鍵指標**是：**互動延遲、裝置相容性、封裝體積、狀態管理與串流穩定性**。下面我用決策樹＋比較表給你一個務實選擇，再附上可落地的模組化架構建議。

---

## 決策樹（先選你最重要的目標）

1. **前端只是一個 LIFF SPA、幾頁 UI、幾乎不需要 SEO？**
   → 直接用 **React + Vite**。
2. **除了 LIFF，還要做官網/內容頁，需要 SSR/SEO、國際化、影像優化、Edge API？**
   → 用 **Next.js** 一站式處理（App Router + Route Handlers）。
3. **追求更小 bundle、更快互動、更簡單語法**（尤其是手機低階機種／動畫多）：
   → 考慮 **SvelteKit**（或 **SolidStart**）。
4. **完全極簡、最快 MVP、依賴很少、全客戶端**：
   → **Vanilla + Vite**（+ 少量狀態管理/路由）。

---

## 框架比較（針對語音即時互動 / LIFF 場景）

| 面向        | React (+Vite)                                  | Next.js               | SvelteKit         | Vanilla(+Vite) |
| --------- | ---------------------------------------------- | --------------------- | ----------------- | -------------- |
| 典型定位      | SPA 前端                                         | 全棧：SSR/SSG/Edge/API   | 輕量全棧              | 超輕量前端          |
| 初次載入體積    | **小**（可用 Preact alias）                         | 中                     | **最小或小**          | **最小**         |
| 語音/串流整合   | 直接用 Web APIs（MediaRecorder/WebAudio/WebSocket） | 同上 + 內建 API Routes    | 同上 + 內建 Endpoints | 同上（自行接後端）      |
| SEO/國際化   | 弱（需額外處理）                                       | **強**（RSC/SSR/i18n）   | 中（有 SSR）          | 弱              |
| 路由/檔案結構   | 自行選（React Router）                              | **檔案式路由**             | 檔案式路由             | 自行處理           |
| 開發體驗      | **成熟、擴充多**                                     | **成熟、整合齊**            | 清爽、學習曲線低          | 極簡、需自己拼積木      |
| 適合你的 LIFF | **非常適合**（純前端）                                  | 若要「官網＋LIFF＋API」一起做很適合 | 若想更輕更快可考慮         | 最快起跑，但長大會重構    |

**結論（多數 LIFF 即時語音場景）：**

> **React + Vite（或 Preact + Vite）** 是最穩妥又輕量的選擇。
> 若你要**同站處理 SSR/SEO + API**，再上 **Next.js**。

---

## 具體技術方案（依你的背景與需求）

### 方案 A｜**React + Vite**（建議首選）

* **為何合適**：LIFF 是 SPA、頁數不多、SEO 非核心；你重視**互動延遲**與**封裝體積**。
* **加值選項**

  * **Preact 取代 React**：`vite-plugin-preact` 或 `alias: react -> preact/compat`，體積可降 30–60%。
  * **狀態管理**：`zustand`（夠輕且簡單），或 `jotai`。
  * **語音/串流**：MediaRecorder + Web Audio API + WebSocket；重運算丟 **Web Worker / AudioWorklet**。
  * **動畫**：`motion`（Framer Motion 的輕替代）或 CSS animations，避免沉重動畫庫。
* **後端**：你擅長 Python → **FastAPI** 做語音上傳、即時轉寫/推理 WebSocket、TTS 流回前端。
* **部署**：靜態前端（Zeabur/S3/CloudFront）＋ FastAPI（AWS）。

### 方案 B｜**Next.js**（當你要一站式整合）

* **為何合適**：同個 repo/網域內要有**官網頁面（SEO）**、**儀表板**、**LIFF**、**簡易 API**。
* **注意**：WebSocket/串流通常走 **Node Runtime 的 Route Handlers**；Edge Runtime 對某些 WebSocket/二進位串流限制較多（需自行驗證當前版本能力）。
* **優勢**：影像最佳化、國際化、檔案路由、RSC。
* **風險**：初次載入會稍大、概念較重（RSC/Server Actions）。**對單純 LIFF 來說可能「火力過猛」**。

### 方案 C｜**SvelteKit**

* **為何考慮**：手機裝置多、你要**最小 bundle、最快互動**與**自然的動畫**。
* **代價**：團隊 React 經驗多時，導入成本與生態遷移要評估。
* **實務**：AudioWorklet/Worker 同樣易整合，開發體驗清爽。

### 方案 D｜**Vanilla + Vite**

* **為何考慮**：超趕的 MVP／PoC，**最小依賴**。
* **代價**：專案成長後，路由、狀態、可維護性會回來找你算帳。

---

## 落地架構（以方案 A：React + Vite 為例）

### 前端模組分層

* **/core/audio/**

  * `recorder.ts`：封裝 MediaRecorder、權限請求、回調/事件。
  * `audioMeter.ts`：`AudioWorklet` 計算音量/RMS，輸出給 radiowave。
  * `ttsPlayer.ts`：串流 TTS（SourceBuffer/MediaSource 或 chunk 播放）。
* **/core/net/**

  * `wsClient.ts`：WebSocket（重試/backoff、心跳、前後端協定）。
  * `api.ts`：REST 上傳（fallback）、簽章/鉴权（LIFF access token）。
* **/state/**

  * `useVoiceStore.ts`（zustand）：錄音狀態、音量、閒置計時器、UI 狀態。
* **/ui/**

  * `MicButton.tsx`：glassmorphic，長按/釋放手勢。
  * `Radiowave.tsx`：根據 `volume` 做擴散動畫（CSS transform + opacity）。
  * `IdleHints.tsx`：左右箭頭動畫（idle > X 秒觸發）。
  * `TopPrompt.tsx`：標題文字。
* **/liff/**

  * `initLiff.ts`：初始化、取得 `userId`、profile、token；錯誤處理。

### 關鍵工程實務

* **低延遲**：WebSocket + chunk 傳輸；TTS 端也要支援「邊合成邊推」。
* **相容性**：`MediaRecorder` 在 iOS 要測版本；必要時 fallback（錄完整段再傳）。
* **音量驅動動畫**：`AudioWorkletNode` 或 `ScriptProcessor`（舊）；節流至 30–45fps，避免主執行緒卡頓。
* **閒置提示**：全域 idle timer（含觸控/滾動/可見性變化 reset）。
* **封裝體積**：preact/compat、移除巨大 UI 套件、按需載入。
* **隱私**：麥克風權限說明、上傳脫敏、錯誤回饋。

---

## 建議結論（給你直接做決策）

* **只做 LIFF 即時語音互動、頁面少、要輕量與低延遲** → **React + Vite（或 Preact + Vite）＋ FastAPI 後端**。
* **同站需要 SEO 的行銷頁、國際化、多角色儀表板與 API** → **Next.js**。
* **追求最小 bundle 與流暢動畫、團隊可接受新語法** → **SvelteKit**。

> 以你目前專案重點（LIFF 即時語音 + radiowave 動畫 + 低延遲）與 Python 背景，我會**首推 React + Vite（可換 Preact）前端**，**後端走 FastAPI（WebSocket + chunk TTS）**。未來若要整併官網與 SSR，再把外層升級到 Next.js 也不遲。

---

## 後續可交付（你要我就直接做）

1. **React + Vite 專案樣板**（含 LIFF 初始化、錄音/播放、音量動畫、idle hints、Zustand 狀態）。
2. **FastAPI WebSocket 範例**（收音訊、回傳 TTS chunk、基本鑑權）。
3. **部署腳本**（Zeabur/AWS 分離式部署）。

---

## 參考文件

* React: [https://react.dev](https://react.dev)
* Vite: [https://vitejs.dev](https://vitejs.dev)
* Next.js: [https://nextjs.org](https://nextjs.org)
* SvelteKit: [https://kit.svelte.dev](https://kit.svelte.dev)
* Web Audio API / AudioWorklet（MDN）: [https://developer.mozilla.org/docs/Web/API/AudioWorklet](https://developer.mozilla.org/docs/Web/API/AudioWorklet)
* MediaRecorder（MDN）: [https://developer.mozilla.org/docs/Web/API/MediaRecorder](https://developer.mozilla.org/docs/Web/API/MediaRecorder)
* LINE LIFF SDK: [https://developers.line.biz/en/docs/liff/](https://developers.line.biz/en/docs/liff/)

---

### 小提示

接下來若你要我**直接產出可執行的前端原型**（含 radiowave 動畫連動音量、glassmorphic 錄音鍵、閒置箭頭提示），我可以一次給你**完整程式碼**與**模組分層**，你貼進 LIFF 就能跑。你想用 React 還是 Preact？我就照那版做。
